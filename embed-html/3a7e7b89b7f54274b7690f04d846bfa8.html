<!DOCTYPE html">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create a document from the template</title>

<script src="https://www.eformsign.com/plugins/jquery/jquery.min.js"></script>
<script src="https://www.eformsign.com/lib/js/efs_embedded_v2.js"></script>

<script type="text/javascript">

const jsondata = '{\
    "시설물": [\
        {\
        "품목": "문형식 세차기",\
        "모델명": "DCW-W0012-128",\
        "제조연도": "2012.12.18",\
        "일련번호": "001",\
        "수량": "1",\
        "단가": "10,000",\
        "금액": "10,000",\
        "비고": "기타"\
        },\
        {\
        "품목": "진공청소기",\
        "모델명": "",\
        "제조연도": "",\
        "일련번호": "",\
        "수량": "1",\
        "단가": "10,000",\
        "금액": "10,000",\
        "비고": ""\
        }\
    ],\
    "수량합계": "2",\
    "금액합계": "20,000",\
    "설치장소": "역전주유소(영주시 선비로 39)"\
}';

const eformsign = new EformSignDocument();

let document_name = "위탁관리대상설비 계약서";

let document_option = {
  "company": {
      "id": "a9c2c0fff3004a7e944f5c4b8f7d83d4",
      "country_code": "kr"
  },
  "user": {
      "type": "01",
      "id": "john.kim@forcs.com",
      "refresh_token": "",
      "access_token": ""
  },
  "mode": {
      "type" : "01",  // 01 : 문서 작성 , 02 : 문서 처리 , 03 : 미리 보기
      "template_id" : "3a7e7b89b7f54274b7690f04d846bfa8"
  },
  "layout" : {
      "lang_code" : localStorage.lang, 
      "header" : false, 
      "footer" : false 
  },
  "prefill": {
      "document_name": document_name,
      "recipients": [
          {
            "step_type": "07",  // 00:시작, 05:참여자, 06:검토자
            "step_idx" : "2",
            "use_mail": true,
            "use_sms": true,
            "name": "홍길동",
            "id": "gildong@gmail.com",
            "sms": "+8201012345678",
            "auth": {
                "password": "",
                "password_hint": "",
                "valid": {
                    "day": 7,
                    "hour": 0
                }
            }
          }
      ],
      "comment": "",
      "fields": [
      ],
  },
  "form_parameters":[
      {
        "name" : "jsonDataset",
        "value" : jsondata
      }
  ],
  "return_fields" : []
};

$(document).ready(function () {

    sucess_callback = function (response) {
        if ('-1' == response.code) {
        alert("Document has been sent successfully.");
        //$('#eformsign_iframe').remove();
        } else {
        alert("sucess_callback: " + response.code + "\n" + response.message);
        }
        $('#close').trigger('click');
        window.close();
    }

    error_callback = function (response) {
        alert("error_callback: " + response.code + "\n" + response.message);
        $('#close').trigger('click');
        window.close();
    };

    const action_callback = function (response) {
        $('#buttonList').find('button').css('display','none');
        $(response.data).each(function(idx, action){
            $('#buttonList').find('button').each(function(idx, btn){
                if ($(btn).attr('id').replace('btn_','') === action.code){
                    if (action.code === '99') {
                        return;
                    }
                    $(btn).attr('title',action.name).text(action.name);
                    $(btn).css('display', 'inline-block');
                }
            });
        });
        console.table(response.data);
    };
    document.getElementById('dname').innerHTML = document_name; 
    eformsign.document(document_option, "eformsign_iframe", sucess_callback, error_callback, action_callback);
    eformsign.open();
});

function action(id) {
    const action = {
    type : '01',
    code : id
    }
    eformsign.sendAction(action);
}

</script>
</head>
<body style="background-color: #EBEDEF; padding: 0">
    <div>
        <b><span id="dname">dname<span/></b>
        <div id="buttonList" style="float:right; padding-bottom: 5px">
            <button id="btn_01" class="actionBtn" onclick="action('01');"></button>
            <button id="btn_02" class="actionBtn" onclick="action('02');"></button>
            <button id="btn_03" class="actionBtn" onclick="action('03');"></button>
            <button id="btn_04" class="actionBtn" onclick="action('04');"></button>
            <button id="btn_05" class="actionBtn" onclick="action('05');"></button>
            <button id="btn_06" class="actionBtn" onclick="action('06');"></button>
            <button id="btn_07" class="actionBtn" onclick="action('07');"></button>
            <button id="btn_08" class="actionBtn" onclick="action('08');"></button>
            <button id="btn_09" class="actionBtn" onclick="action('09');"></button>
            <button id="btn_10" class="actionBtn" onclick="action('10');"></button>
            <button id="btn_11" class="actionBtn" onclick="action('11');"></button>
            <button id="btn_12" class="actionBtn" onclick="action('12');"></button>
            <button id="btn_13" class="actionBtn" onclick="action('13');"></button>
            <button id="btn_14" class="actionBtn" onclick="action('14');"></button>
            <button id="btn_15" class="actionBtn" onclick="action('15');"></button>
            <button id="btn_16" class="actionBtn" onclick="action('16');"></button>
            <button id="btn_17" class="actionBtn" onclick="action('17');"></button>
            <button id="btn_18" class="actionBtn" onclick="action('18');"></button>
            <button id="btn_19" class="actionBtn" onclick="action('19');"></button>
            <button id="btn_99" class="actionBtn" onclick="action('99');"></button>
            <button id="btn_00" class="actionBtn" onclick="action('00');"></button>
            <button id="btn_20" class="actionBtn" onclick="action('20');"></button>
            <button id="btn_21" class="actionBtn" onclick="action('21');"></button>
            <button id="btn_22" class="actionBtn" onclick="action('22');"></button>
            <button id="btn_23" class="actionBtn" onclick="action('23');"></button>
        </div>
    </div>
    <iframe id="eformsign_iframe" name="eformsign_iframe" frameborder="0" style="width:99vw; height: 93vh"></iframe>
</body>
<style>
    .actionBtn {
        display: none;
        border: none;
        border-radius: 4px;
        background-color: #04AA6D;
        color: white;
        padding: 3px;
        text-align: center;
        text-decoration: none;
        font-size: 14px;
        font-weight: bold;
        transition-duration: 0.4s;
        cursor: pointer;
        width:100px; height:30px;
    }
    .actionBtn:hover {
        background-color: green;
        color: white;
    }
</style>
</html>
