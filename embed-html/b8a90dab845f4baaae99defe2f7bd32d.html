<!DOCTYPE html">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create a document from the template</title>
<link href="/view/style.css" rel="stylesheet" type="text/css" />
<script src="https://kit.fontawesome.com/d9ef70aab0.js" crossorigin="anonymous"></script>
<script src="https://www.eformsign.com/plugins/jquery/jquery.min.js"></script>
<script src="https://www.eformsign.com/lib/js/efs_embedded_v2.js"></script>
<script src="/js/resource.js"></script>
<script type="text/javascript">
const json = '{계약:  {  "대표자": "김종민",  "휴대폰": "1011112222",  "이메일": "kjm6595@naver.com",  "프로젝트명": "프로젝트A",  "계약번호": "A-12345",  "계약금액": "20,000,000" }}';


const query = window.location.search;
const param = new URLSearchParams(query);
let order = param.get('order');

let document_option = {
  "company": {
      "id": "a9c2c0fff3004a7e944f5c4b8f7d83d4",
      "country_code": "kr"
  },
  "user": {
      "type": "01",
      "id": "john.kim@forcs.com",
      "refresh_token": "",
      "access_token": ""
  },
  "mode": {
      "type" : "01",  // 01 : 문서 작성 , 02 : 문서 처리 , 03 : 미리 보기
      "template_id" : "b8a90dab845f4baaae99defe2f7bd32d"
  },
  "layout" : {
      "lang_code" : "ko",
      "header" : false, 
      "footer" : false 
  },
  "prefill": {
      "recipients": [
          {
            "step_type": "01",  // 00:시작, 05:참여자, 06:검토자
            "step_idx" : "1",
            "use_mail": true,
            "use_sms": true,
            "name": "홍길동",
            "id": "gildong@gmail.com",
            "sms": "+8201012345678",
            "auth": {
                "password": "",
                "password_hint": "",
                "valid": {
                    "day": 7,
                    "hour": 0
                }
            }
          }
      ],
      "comment": "",
      "fields": [
      ],
  },
  "form_parameters":[
      {
        "name" : "json",
        "value" : json
      },
      {
        "name" : "order",
        "value" : order
      }
  ],
  "return_fields" : []
};

let eformsign = new EformSignDocument();
eformsign.setDomain('https://www.eformsign.com');

$(document).ready(function () {
    
    let sucess_callback = function (response) {
        if ("-1" == response.code) {
            console.log(response);
            alert(response.message);
        } else {
            alert(response.code + ":\n" + response.message);
        }
        $('#close').trigger('click');
        window.close();
    };

    let error_callback = function (response) {
        alert(response.code + ":\n" + response.message);
        $('#close').trigger('click');
        window.close();
    };

    let action_callback = function (response) {
        $('#buttonList').find('button').css('display','none');
        $(response.data).each(function(idx, action){
            $('#buttonList').find('button').each(function(idx, btn){
                if ($(btn).attr('id').replace('btn_','') === action.code){
                    if (action.code === '99') {
                        return;
                    }
                    $(btn).attr('title',action.name).text(action.name);
                    $(btn).css('display', 'inline-block');
                }
            });
        });
        console.table(response.data);
    };
    eformsign.document(document_option, "eformsign_iframe", sucess_callback, error_callback, action_callback);
    eformsign.open();
    document.getElementById("templateName").innerHTML = localStorage.templateName;
});

function action(id) {
    const action = {
      type : '01',
      code : id
    }
    eformsign.sendAction(action);
}
</script>
</head>
<body style="background-color: #EBEDEF; padding: 5px">
  <div style="margin:3px 0 0 5px">
    <img src="/image/apidemo_symbol.png" alt="logo" height="24px" style="float: left; padding-right: 20px; margin-top:-2px">
      <b><span id="templateName"></span></b> (add url parameter such as 'order=101')
      <div id="buttonList" style="float:right; padding: 0 10px; margin:-4px 0 3px;">
        <button id="btn_01" class="actionBtn" onclick="action('01');"></button>
        <button id="btn_02" class="actionBtn" onclick="action('02');"></button>
        <button id="btn_03" class="actionBtn" onclick="action('03');"></button>
        <button id="btn_04" class="actionBtn" onclick="action('04');"></button>
        <button id="btn_05" class="actionBtn" onclick="action('05');"></button>
        <button id="btn_06" class="actionBtn" onclick="action('06');"></button>
        <button id="btn_07" class="actionBtn" onclick="action('07');"></button>
        <button id="btn_08" class="actionBtn" onclick="action('08');"></button>
        <button id="btn_09" class="actionBtn" onclick="action('09');"></button>
        <button id="btn_10" class="actionBtn" onclick="action('10');"></button>
        <button id="btn_11" class="actionBtn" onclick="action('11');"></button>
        <button id="btn_12" class="actionBtn" onclick="action('12');"></button>
        <button id="btn_13" class="actionBtn" onclick="action('13');"></button>
        <button id="btn_14" class="actionBtn" onclick="action('14');"></button>
        <button id="btn_15" class="actionBtn" onclick="action('15');"></button>
        <button id="btn_16" class="actionBtn" onclick="action('16');"></button>
        <button id="btn_17" class="actionBtn" onclick="action('17');"></button>
        <button id="btn_18" class="actionBtn" onclick="action('18');"></button>
        <button id="btn_19" class="actionBtn" onclick="action('19');"></button>
        <button id="btn_99" class="actionBtn" onclick="action('99');"></button>
        <button id="btn_00" class="actionBtn" onclick="action('00');"></button>
        <button id="btn_20" class="actionBtn" onclick="action('20');"></button>
        <button id="btn_21" class="actionBtn" onclick="action('21');"></button>
        <button id="btn_22" class="actionBtn" onclick="action('22');"></button>
        <button id="btn_23" class="actionBtn" onclick="action('23');"></button>
      </div>
      <span id="recipient" style="float: right"></span>
    </div>
    <iframe id="eformsign_iframe" name="eformsign_iframe" frameborder="0" style="margin-left: 5px;width:98vw; height: 93vh"></iframe>
  </body>
  </html>