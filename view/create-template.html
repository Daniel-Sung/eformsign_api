<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>Create template from a file</title>
<link href="/view/style.css" rel="stylesheet" type="text/css" />
<script src="https://kit.fontawesome.com/d9ef70aab0.js" crossorigin="anonymous"></script>
<script src="https://www.eformsign.com/plugins/jquery/jquery.min.js"></script>
<script src="https://www.eformsign.com/lib/js/efs_embedded_form.js"></script>
<script src="/js/resource.js"></script>

<script type="text/javascript">
var eformsign, templateId, templateFile, actionType;
var sucess_callback, error_callback, action_callback;

var template_option_file = {
	company: {
		id: localStorage.company_id, // 회사의 id - 회사관리 - 회사 정보 에서 확인 - 필수 - local
		country_code: localStorage.country_code // 비필수 이나, 지정해 주는 것이 좋음. ( 회사 관리의 회사 정보에서 국가에 대한 코드를 지정 ) - 빠른 open이 가능함.
		//user_key: "",
	},
	user: {
		type: "01",
		id: localStorage.memberId,    // 사용자 ID(이메일)
		access_token: localStorage.access_token,
		refresh_token: localStorage.refresh_token
	},
	mode: {
		type: "01", // 01 : 생성 , 02 : 수정, 03 : 복제
		template_type: "form"
	},
	layout: {
		lang_code: localStorage.lang, 
		header: false,
		footer: false,
	},
	prefill: {
		template_name: "",
		step_settings: [
			{
				step_type: "05", // 02, 03, 04, 05, 06
				step_name: "참여자1",
				use_mail: true,
				use_sms: true,
				use_alimtalk: true,
			},
			{
				step_type: "05", // 02, 03, 04, 05, 06
				step_name: "참여자2",
				use_mail: true,
				use_sms: false,
				use_alimtalk: false, // 알림톡 사용 여부
				auth: {
					type: "password", // password, qna , field
					password: "",
					password_hint: "",
					valid: {
						day: "7",
						hour: "0",
					},
				},
				additional_auth: {
					// 추가 인증 수단
					use_mail: true, //이메일 인증
					use_sms: false, // 휴대폰 본인 확인
					use_sms_result: false, //문서 최종 완료 시 휴대폰 본인 확인 사용
				},
			},
		],
		// participants_popup: false,
		// quick_processing: true,
		// webhook: ["d2f4bf0519db42eca854e4378913f135"],		// Webhook 등록 필요시 해당 부분 추가
	},
	tempalte_file: {
		mime: "@file/octet-stream",
		name: "",
		data: ""

	},
};

$(document).ready(function () {
	eformsign = new EformSignTemplate();
	eformsign.setDomain('https://www.eformsign.com');

	sucess_callback = function (response) {
		if (response.type ==='template'){
			console.log(response.template_id);
			console.log(response.template_name);
			console.table(response.step_settings);
			if ("-1" == response.code) {
				//alert("템플릿 생성되었습니다.\n" + "- document_id : " + response.template_id + "\n- title : " + response.template_name);
			} else {
				alert("템플릿 생성 오류:\n" + "- cdoe : " + response.code + "\n- message : " + response.message);
			}
		}
		window.close();
	};

	error_callback = function (response) {
		alert("템플릿 생성 오류:\n" + "- cdoe : " + response.code + "\n- message : " + response.message);
		console.log(response.code);
		console.log(response.message);
		window.close();
	};

	action_callback = function (response) {
		if (response.type === "template") {
			actionType = "02";
		}
		$("#buttonList").find("button").css("display", "none");
		$(response.data).each(function (idx, action) {
			$("#buttonList")
				.find("button")
				.each(function (idx, btn) {
					if ($(btn).attr("id").replace("btn_", "") === action.code) {
						$(btn).attr("title", action.name).text(action.name.replace('하기',''));
						$(btn).css("display", 'inline-block');
					}
				});
		});
		console.table(response.data);
	};

	setLang();
});

function action(action) {
	var action = {
		type: actionType,
		code: action,
	};
	eformsign.sendAction(action);
}

function getTname() {
	template_option_file.prefill.template_name = document.getElementById("templateName").value;
	eformsign.template(template_option_file, "eformsign_iframe", sucess_callback, error_callback, action_callback);
	eformsign.open();
	document.getElementById("tname").style.display = "none";
}
		
</script>
</head>

<body style="background-color: #EBEDEF; padding: 5px 0 5px 20px">
	<div class="row" style="margin-bottom: 2px;">
	  <img src="/image/apidemo_symbol.png" alt="logo" height="26px" style="margin-right: 20px; margin-top: 3px;;">
	  <div style="display:inline-block; vertical-align: top; font-size: 16px; font-weight: bold;">
		<span data-text="NEW"></span> <i class="fa-solid fa-angle-right"></i>  <span data-text="TEMPLATE_NAME"></span>
		<input type="text" id="templateName" style="font-size: 18px; font-weight: bold; text-align: center; width: 290px; padding: 2px; border: 1px solid #ccc;">
		<button type="button" id="tname" class="actionBtn" style="display: inline-block; vertical-align: top;" onclick="getTname();" data-text="CREATE_TEMPLATE"></button>
		<div id="buttonList" style="padding: 10px; margin: -10px 0 0 0; float:right;">
		<button id="btn_03" class="actionBtn" onclick="action('03');"></button>
		<button id="btn_04" class="actionBtn" onclick="action('04');"></button>
		<button id="btn_02" class="actionBtn" onclick="action('02');"></button>
		<button id="btn_01" class="actionBtn" onclick="action('01');"></button>
		<button id="btn_05" class="actionBtn" onclick="action('05');"></button>
		<button id="btn_06" class="actionBtn" onclick="action('06');"></button>
	  </div>
	  </div>
	</div>
	<iframe id="eformsign_iframe" name="eformsign_iframe" frameborder="1" style="width:98vw; height: 93vh"></iframe>
  </body>
  </html>
  